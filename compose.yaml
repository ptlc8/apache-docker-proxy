services:
  config-generator:
    build: ./config-generator
    volumes:
      - /var/run/docker.sock:/tmp/docker.sock:ro
      - httpd-config:/etc/docker-gen/results:rw
    environment:
      - TOPDOMAIN=$TOPDOMAIN
      - DEFAULT_REDIRECT_TO_TOPDOMAIN=$DEFAULT_REDIRECT_TO_TOPDOMAIN
    restart: always
  http-daemon:
    build: ./http-daemon
    volumes:
      - httpd-config:/usr/local/apache2/conf/web-proxy:rw
      - ./html:/usr/local/apache2/htdocs:ro
    ports:
      - 80:80
    restart: always
volumes:
  httpd-config:
    driver: local